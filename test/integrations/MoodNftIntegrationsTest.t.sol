//SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

import {MoodNft} from "../../src/MoodNft.sol";
import {Test, console} from "forge-std/Test.sol";
import {DeployMoodNft} from "../../script/DeployMoodNft.s.sol";

contract MoodNftIntegrationsTest is Test {
    MoodNft moodNft;
    address public USER = makeAddr("User");
    DeployMoodNft deployer;
    string public constant HAPPY_SVG_IMAGE_URI =
        "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPCEtLSBCYWNrZ3JvdW5kIENpcmNsZSAtLT4KICA8ZGVmcz4KICAgIDxyYWRpYWxHcmFkaWVudCBpZD0iZmFjZUdyYWRpZW50IiBjeD0iNTAlIiBjeT0iNTAlIiByPSI1MCUiIGZ4PSI1MCUiIGZ5PSI1MCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjogI0ZEREM4QTsgc3RvcC1vcGFjaXR5OiAxIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiAjRkJDNjc4OyBzdG9wLW9wYWNpdHk6IDEiIC8+CiAgICA8L3JhZGlhbEdyYWRpZW50PgogIDwvZGVmcz4KICA8Y2lyY2xlIGN4PSIxMDAiIGN5PSIxMDAiIHI9IjkwIiBmaWxsPSJ1cmwoI2ZhY2VHcmFkaWVudCkiIC8+CgogIDwhLS0gRXllcyAtLT4KICA8ZWxsaXBzZSBjeD0iNjUiIGN5PSI4MCIgcng9IjIwIiByeT0iMTIiIGZpbGw9IndoaXRlIiAvPgogIDxlbGxpcHNlIGN4PSIxMzUiIGN5PSI4MCIgcng9IjIwIiByeT0iMTIiIGZpbGw9IndoaXRlIiAvPgoKICA8IS0tIFB1cGlscyAtLT4KICA8Y2lyY2xlIGN4PSI2NSIgY3k9IjgwIiByPSI3IiBmaWxsPSJibGFjayIgLz4KICA8Y2lyY2xlIGN4PSIxMzUiIGN5PSI4MCIgcj0iNyIgZmlsbD0iYmxhY2siIC8+CgogIDwhLS0gU3VidGxlIEV5ZWJhZ3MgLS0+CiAgPHBhdGggZD0iTTQ1LDkwIFE2NSwxMDAgODUsOTAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0Y5QUI2NCIgc3Ryb2tlLXdpZHRoPSIyIiAvPgogIDxwYXRoIGQ9Ik0xMTUsOTAgUTEzNSwxMDAgMTU1LDkwIiBmaWxsPSJub25lIiBzdHJva2U9IiNGOUFCNjQiIHN0cm9rZS13aWR0aD0iMiIgLz4KCiAgPCEtLSBNb3V0aCAoSGFwcHkgYnV0IFVuY2FubnkpIC0tPgogIDxwYXRoIGQ9Ik01MCwxMzAgUTEwMCwxNzAgMTUwLDEzMCBRMTIwLDE1MCA1MCwxMzAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0Q2NzQ1RSIgc3Ryb2tlLXdpZHRoPSI1IiAvPgoKICA8IS0tIFN1YnRsZSBTaGFkb3dzIGZvciBSZWFsaXNtIC0tPgogIDxlbGxpcHNlIGN4PSIxMDAiIGN5PSIyMCIgcng9IjY1IiByeT0iMTUiIGZpbGw9InJnYmEoMCwwLDAsMC4xKSIgLz4KPC9zdmc+Cg==";

    string public constant SAD_SVG_IMAGE_URI =
        "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPCEtLSBGYWNlIE91dGxpbmUgLS0+CiAgPGVsbGlwc2UgY3g9IjEwMCIgY3k9IjEwMCIgcng9IjkwIiByeT0iMTAwIiBmaWxsPSIjZmZlMGJkIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjIiIC8+CgogIDwhLS0gRXllcyAtLT4KICA8Y2lyY2xlIGN4PSI3MCIgY3k9IjgwIiByPSI4IiBmaWxsPSJibGFjayIgLz4KICA8Y2lyY2xlIGN4PSIxMzAiIGN5PSI4MCIgcj0iOCIgZmlsbD0iYmxhY2siIC8+CgogIDwhLS0gRXllYnJvd3MgLS0+CiAgPHBhdGggZD0iTTYwLDY1IFE3MCw2MCA4MCw2NSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIyIiAvPgogIDxwYXRoIGQ9Ik0xMjAsNjUgUTEzMCw2MCAxNDAsNjUiIGZpbGw9Im5vbmUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMiIgLz4KCiAgPCEtLSBNb3V0aCAoU2FkIGV4cHJlc3Npb24pIC0tPgogIDxwYXRoIGQ9Ik03MCwxNDAgUTEwMCwxMzAgMTMwLDE0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIyIiAvPgoKICA8IS0tIEZvcmVoZWFkIFdyaW5rbGVzIChDb3JyZWN0IHBsYWNlbWVudCkgLS0+CiAgPHBhdGggZD0iTTY1LDUwIFExMDAsNDUgMTM1LDUwIiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEiIC8+CiAgPHBhdGggZD0iTTcwLDU1IFExMDAsNTAgMTMwLDU1IiBmaWxsPSJub25lIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEiIC8+Cjwvc3ZnPgo=";

    string public constant SAD_SVG_URI =
        "data:application/json;base64,eyJuYW1lIjoiTW9vZCBORlQiZGVzY3JpcHRpb24iOiAiQW4gTkZUIHRoYXQgcmVwcmVzZW50cyBZT1VSIG1vb2QhIiwgImF0dHJpYnV0ZXMiOiBbeyJ0cmFpdF90eXBlIjogIk1vb2QiLCAidmFsdWUiOiAxMDB9XSwgImltYWdlIjogZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpBd0lpQm9aV2xuYUhROUlqSXdNQ0lnZG1sbGQwSnZlRDBpTUNBd0lESXdNQ0F5TURBaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK0NpQWdQQ0V0TFNCR1lXTmxJRTkxZEd4cGJtVWdMUzArQ2lBZ1BHVnNiR2x3YzJVZ1kzZzlJakV3TUNJZ1kzazlJakV3TUNJZ2NuZzlJamt3SWlCeWVUMGlNVEF3SWlCbWFXeHNQU0lqWm1abE1HSmtJaUJ6ZEhKdmEyVTlJbUpzWVdOcklpQnpkSEp2YTJVdGQybGtkR2c5SWpJaUlDOCtDZ29nSUR3aExTMGdSWGxsY3lBdExUNEtJQ0E4WTJseVkyeGxJR040UFNJM01DSWdZM2s5SWpnd0lpQnlQU0k0SWlCbWFXeHNQU0ppYkdGamF5SWdMejRLSUNBOFkybHlZMnhsSUdONFBTSXhNekFpSUdONVBTSTRNQ0lnY2owaU9DSWdabWxzYkQwaVlteGhZMnNpSUM4K0Nnb2dJRHdoTFMwZ1JYbGxZbkp2ZDNNZ0xTMCtDaUFnUEhCaGRHZ2daRDBpVFRZd0xEWTFJRkUzTUN3Mk1DQTRNQ3cyTlNJZ1ptbHNiRDBpYm05dVpTSWdjM1J5YjJ0bFBTSmliR0ZqYXlJZ2MzUnliMnRsTFhkcFpIUm9QU0l5SWlBdlBnb2dJRHh3WVhSb0lHUTlJazB4TWpBc05qVWdVVEV6TUN3Mk1DQXhOREFzTmpVaUlHWnBiR3c5SW01dmJtVWlJSE4wY205clpUMGlZbXhoWTJzaUlITjBjbTlyWlMxM2FXUjBhRDBpTWlJZ0x6NEtDaUFnUENFdExTQk5iM1YwYUNBb1UyRmtJR1Y0Y0hKbGMzTnBiMjRwSUMwdFBnb2dJRHh3WVhSb0lHUTlJazAzTUN3eE5EQWdVVEV3TUN3eE16QWdNVE13TERFME1DSWdabWxzYkQwaWJtOXVaU0lnYzNSeWIydGxQU0ppYkdGamF5SWdjM1J5YjJ0bExYZHBaSFJvUFNJeUlpQXZQZ29LSUNBOElTMHRJRVp2Y21Wb1pXRmtJRmR5YVc1cmJHVnpJQ2hEYjNKeVpXTjBJSEJzWVdObGJXVnVkQ2tnTFMwK0NpQWdQSEJoZEdnZ1pEMGlUVFkxTERVd0lGRXhNREFzTkRVZ01UTTFMRFV3SWlCbWFXeHNQU0p1YjI1bElpQnpkSEp2YTJVOUltSnNZV05ySWlCemRISnZhMlV0ZDJsa2RHZzlJakVpSUM4K0NpQWdQSEJoZEdnZ1pEMGlUVGN3TERVMUlGRXhNREFzTlRBZ01UTXdMRFUxSWlCbWFXeHNQU0p1YjI1bElpQnpkSEp2YTJVOUltSnNZV05ySWlCemRISnZhMlV0ZDJsa2RHZzlJakVpSUM4K0Nqd3ZjM1puUGdvPSJ9";

    function setUp() public {
        deployer = new DeployMoodNft();
        moodNft = new MoodNft(SAD_SVG_IMAGE_URI, HAPPY_SVG_IMAGE_URI);
    }

    function testViewTokenURIIntegration() public {
        vm.prank(USER);
        moodNft.mintNft();
        console.log(moodNft.tokenURI(0));
    }

    function testFlipMoodIntegration() public {
        vm.prank(USER);
        moodNft.mintNft();
        MoodNft.Mood starterMood = moodNft.getMood(0);
        vm.prank(USER);
        moodNft.flipMood(0);
        assert(starterMood != moodNft.getMood(0));
        assert(moodNft.getMood(0) == MoodNft.Mood.SAD);
        assert(keccak256(abi.encodePacked(moodNft.tokenURI(0))) == keccak256(abi.encodePacked(SAD_SVG_URI)));
    }
}
